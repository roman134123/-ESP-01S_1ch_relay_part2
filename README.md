# ESP-01S_1ch_relay_part2
Wi-Fi реле на основе ESP-01S. Часть 2. Интеграция в систему Умного Дома. 

В первой части поста о Wi-Fi реле на основе ESP-01S обсуждалась возможность сборки устройства для управления нагрузкой через адресную строку браузера. Во второй части мы расскажем о сборке устройства, его прошивке и интеграции в систему Умного Дома при помощи настроек ESPHome (на примере Home Assistant).

Для интеграции одноканального реле на ESP-01S в Home Assistant потребуется непосредственно сам Home Assistant, установленная в нем конфигурация ESPHome и набор модулей для устройства (плата расширения с реле, модуль ESP-01S, программатор и преобразователь напряжения (блок питания) AC/DC 220В-5В 0,7А.

Сперва необходимо создать конфигурационный файл в интеграции ESPHome сервера Умного Дома: ESPHome – New device. В открывшемся окне ввести название устройства, например «esp01-relay-test», далее необходимо выбрать тип платы ESP и нажать Next. Появится сообщение об успешном создании новой конфигурации. В списке конфигураций ESPHome нужно отредактировать только что созданный файл редактором. В структуре файла необходимо указать: хостнейм, имя устройства, тип платы ESP, название и пароль Вашей Wi-Fi сети, ввести тип платформы конфигурации, номер пина реле, имя устройства и состояние, при котором будет находиться реле при включении в сеть (для удобства можно скопировать код с сайта ESPHome - https://www.esphome-devices.com/devices/ESP-01S-1-channel-relay). Дополнительные сенсоры, такие как уровень Wi-Fi сигнала, uptime, и пр., перечисленные в примере на сайте ESPHome не важны в рамках работы реле). После внесения вышеперечисленной информации сохраните файл конфигурации, нажав кнопку «SAVE». На основной странице ESPHome после сохранения появится уведомление о сохранении файла, далее необходимо загрузить прошивку в ESP-01S: вызываем подменю конфигурации нажатием на кнопку с тремя точками, в появившемся окне выбираем прошивку через COM-порт, и открываем WEB-страницу для загрузки прошивки (Open ESPHome Web). В открывшейся вкладке браузера подключаемся к COM-порту с ESP-01S (после подключения статус ESP Device должен измениться на «CONNECTED», вкладку не закрываем. Возвращаемся на предыдущую вкладку браузера и дождавшись компиляции прошивки скачиваем бинарный файл, нажав на ссылку «Download project». Вновь открываем WEB-страницу для загрузки прошивки, нажимаем кнопку «INSTALL», в появившемся окне указываем путь к бинарному файлу с прошивкой и устанавливаем ее. После успешной загрузки прошивки можно закрыть вкладку WEB-страницы для загрузки прошивки и на основной странице ESPHome увидим файл конфигурации нашего устройства в статусе «ONLINE». Теперь необходимо добавить файл конфигурации в интеграцию ESPHome: обычно, это происходит автоматически: появляется уведомление о новом устройстве в системе Home Assistant и далее необходимо только его добавить в «два клика», если автоматически устройство не обнаружилось, то его можно добавить вручную. Для этого нужно узнать, какой IP-адрес присвоился устройству: проверяем LOGS конфигурации нашего реле в ESPHome, в открывшейся командной строке находим IP-адрес, копируем его. В настройках Home Assistant выбираем раздел «Интеграции» - Добавить интеграцию – (в поиске) – ESPHome – в строке Хоста прописать скопированный IP-адрес реле и подтвердить добавление устройства. После успешного добавления станет доступно управление состоянием реле переключателем. 

Данное устройство, интегрированное в Умный Дом, может быть вовлечено во все возможные автоматизации, сцены и скрипты системы наравне с коммерческими Wi-Fi и ZigBee переключателями и реле. 

К заказу доступны как отдельные компоненты устройства, так и в наборах.
https://vk.com/market-204236373?section=album_22 
https://vk.com/retech_msc
